<ng-container *ngIf="showToolbar">
  <app-toolbar *ngIf="!modal; else modalToolbar" [defaultBackHref]="$defaultBackHref | async" canGoBack="false">
    <ion-title [innerHTML]="$title | async"></ion-title>

    <ion-buttons slot="end">
      <!-- Refresh -->
      <ion-button *ngIf="uuid | isNilOrBlank" (click)="onRefresh.emit()" [title]="'COMMON.BTN_REFRESH' | translate">
        <mat-icon>refresh</mat-icon>
      </ion-button>

      <!-- Help button -->
      <ion-button (click)="reveal.toggleHelp()">
        <mat-icon>help_outline</mat-icon>
      </ion-button>

      <!-- Print -->
      <!-- FIXME enable for mobile, using a Capacitor plugin ? -->
      <ion-button (click)="reveal.print($event)" *ngIf="!mobile">
        <!-- Print button -->
        <ion-icon name="print"></ion-icon>
      </ion-button>

      <!-- share menu -->
      <button mat-icon-button matHeader [title]="'COMMON.SHARE.BTN_SHARE' | translate" [matMenuTriggerFor]="shareMenu">
        <mat-icon>share</mat-icon>
      </button>
    </ion-buttons>
  </app-toolbar>

  <mat-menu #shareMenu="matMenu" xPosition="after">
    <!-- Share popover -->
    <button mat-menu-item (click)="showSharePopover($event)" [disabled]="(loadingSubject | async) || network.offline">
      <ion-label>{{ 'COMMON.SHARE.BTN_SHARE_DOTS' | translate }}</ion-label>
    </button>
  </mat-menu>

  <ng-template #modalToolbar>
    <app-modal-toolbar *ngIf="showToolbar" [modalName]="modalName" [color]="'secondary'" (cancel)="cancel()" [canValidate]="false">
      <ion-title [innerHTML]="$title | async"></ion-title>

      <!-- Print button -->
      <ion-button slot="end" (click)="reveal.print($event)">
        <ion-icon name="print"></ion-icon>
      </ion-button>

      <!-- Close button (on desktop screen) -->
      <ion-button hidden-xs hidden-sm hidden-mobile slot="end" (click)="cancel()" (keyup.enter)="cancel()">
        <ion-label translate>COMMON.BTN_CLOSE</ion-label>
      </ion-button>
    </app-modal-toolbar>
  </ng-template>
</ng-container>

<ion-content>
  <ion-item *ngIf="error && showError" lines="none">
    <ion-icon color="danger" slot="start" name="alert-circle"></ion-icon>
    <ion-label color="danger" class="error" [innerHTML]="error | translate"></ion-label>
  </ion-item>

  <app-reveal #reveal [options]="revealOptions" *ngIf="loaded; else loadingTemplate">
    <section *sectionDef class="portrait">
      <ion-grid class="report-header ion-no-padding">
        <ion-row class="document-title">
          <ion-col class="logo" size="2">
            @if (stats?.logoHeadLeftUrl | isNotNilOrBlank) {
              <img [src]="stats.logoHeadLeftUrl" />
            }
          </ion-col>
          <ion-col size="8">
            <h1 class="ion-text-uppercase">{{ 'OBSERVED_LOCATION.REPORT.FORM.TITLE' | translateContext: i18nContext.suffix }}</h1>
            <h2>
              @if (stats?.subtitle | isNotNilOrBlank) {
                {{ stats.subtitle }}
              } @else {
                {{ stats.program.description }}
              }
            </h2>
          </ion-col>
          <ion-col class="logo" size="2">
            @if (stats?.logoHeadLeftUrl | isNotNilOrBlank) {
              <img [src]="stats.logoHeadRightUrl" />
            }
          </ion-col>
        </ion-row>
      </ion-grid>

      <ion-grid class="report-section">
        <ion-row class="page-title ion-padding">
          <ion-col>
            <h2>{{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.TITLE' | translate }}</h2>
          </ion-col>
        </ion-row>
      </ion-grid>

      <!-- Section link with the sampling plan -->
      <ion-grid class="report-section">
        <ion-row class="section-title">
          <ion-col>
            <h3>{{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.LINK_WITH_THE_SAMPLING_PLAN' | translate }}</h3>
          </ion-col>
        </ion-row>
        <ion-row class="form-field">
          <ion-col class="form-label" size="4">
            {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.OBSERVED_LOCATION' | translate }}
          </ion-col>
          <ion-col class="form-value" size="8">
            <!-- CHECK_IT -->
            {{ data.location?.name }}
          </ion-col>
        </ion-row>
        <ion-row class="form-field">
          <ion-col class="form-label" size="4">
            {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.ATTACHMENT_PROGRAM' | translate }}
          </ion-col>
          <ion-col class="form-value no-border-top" size="8">
            <!-- CHECK_IT -->
            {{ isBlankForm ? '' : stats.program.label }}
          </ion-col>
        </ion-row>
      </ion-grid>

      <!-- Observers section -->
      <ion-grid class="report-section">
        <ion-row class="section-title">
          <ion-col>
            <h3>{{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.OBSERVERS' | translate }}</h3>
          </ion-col>
        </ion-row>
        @for (observer of data.observers; track $index) {
          <ion-row class="form-field">
            <ion-col class="form-label" size="4">
              {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.' + (isBlankForm ? 'OBSERVERS_NAMES' : 'OBSERVERS_NAMES_WITH_SOCIETY') | translate }}
            </ion-col>
            <ion-col class="form-value" [class.no-border-top]="$index > 0" size="8">
              {{ observer | personToString: ', ' : { withDepartment: true } }}
            </ion-col>
          </ion-row>
        }
        @if (isBlankForm) {
          <ion-row class="form-field">
            <ion-col class="form-label" size="4">
              {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.SOCIETY' | translate }}
            </ion-col>
            <ion-col class="form-value no-border-top" size="8"></ion-col>
          </ion-row>
        }
      </ion-grid>

      <!-- Global trip information -->
      <ion-grid class="report-section">
        <ion-row class="section-title">
          <ion-col>
            <h3>{{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.TRIP_INFORMATION' | translate }}</h3>
          </ion-col>
        </ion-row>
        <ion-row class="form-field">
          <ion-col class="form-label" size="4">
            {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.TYPE_OF_TRIP' | translate }}
          </ion-col>
          <ion-col class="form-value" size="8">
            <!-- TODO -->
          </ion-col>
        </ion-row>
        <ion-row class="form-field">
          <ion-col class="form-label" size="4">
            {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.START_DATE' | translate }}
          </ion-col>
          <ion-col class="form-value no-border-top" size="8">
            <!-- CHECK_IT -->
            {{ data.startDateTime | dateFormat: { time: true } }}
          </ion-col>
        </ion-row>
        <ion-row class="form-field">
          <ion-col class="form-label" size="4">
            {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.END_DATE' | translate }}
          </ion-col>
          <ion-col class="form-value no-border-top" size="8">
            <!-- CHECK_IT -->
            {{ data.endDateTime | dateFormat: { time: true } }}
          </ion-col>
        </ion-row>
        <ion-row class="form-field">
          <ion-col class="form-label" size="4">
            {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.SELL_TYPE' | translate }}
          </ion-col>
          <ion-col class="form-value no-border-top" size="8">
            <!-- TODO -->
          </ion-col>
        </ion-row>
        <ion-row class="form-field">
          <ion-col class="form-label" size="4">
            {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.SELL_DATE' | translate }}
          </ion-col>
          <ion-col class="form-value no-border-top" size="8">
            <!-- TODO -->
          </ion-col>
        </ion-row>

        <ion-row class="form-field ion-margin-top">
          <ion-col class="form-label horiz-checkbox" size="6">
            <!-- TODO : Insert data -->
            <span>
              {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.RETURN_FISHMONGER_CARD' | translate }}
              <br />
              <span class="help">
                {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.HELP_INCLUDE_DOCUMENT' | translate }}
              </span>
            </span>
            <ion-icon [name]="'square-outline'"></ion-icon>
          </ion-col>
          <ion-col class="form-label horiz-checkbox" size="6">
            <span>
              {{
                stats.pmfmsByIds.observedLocation[pmfmIdsMap.PRESALE_AVAILABLE]
                  | pmfmName: { i18nPrefix: i18nContext.pmfmPrefix, i18nContext: i18nContext.suffix }
              }}
              <br />
              <span class="help">
                {{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.HELP_INCLUDE_DOCUMENT' | translate }}
              </span>
            </span>
            <ion-icon [name]="(data.measurementValues | mapGet: pmfmIdsMap.PRESALE_AVAILABLE) ? 'checkbox-outline' : 'square-outline'"></ion-icon>
          </ion-col>
        </ion-row>

        <ion-row class="form-field ion-margin-top">
          <ion-col class="form-label" size="4" [innerHTML]="'OBSERVED_LOCATION.REPORT.FORM.LANDING.USE_MEASUREMENT_TOOL' | translate"></ion-col>
          <ion-col class="form-value" size="8">
            <ion-grid class="inner-grid">
              <ion-row class="form-field">
                <ion-col class="form-label" size="1">
                  {{ 'COMMON.YES' | translate }}
                </ion-col>
                <ion-col class="form-value no-border" size="1">
                  <ion-icon [name]="'square-outline'"></ion-icon>
                </ion-col>
                <ion-col class="form-value no-border" size="4">{{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.IWA_FILE_NAME' | translate }}</ion-col>
                <ion-col class="form-value no-border" size="6"></ion-col>
              </ion-row>
              <ion-row class="form-field">
                <ion-col class="form-label" size="1">
                  {{ 'COMMON.NO' | translate }}
                </ion-col>
                <ion-col class="form-value no-border" size="1">
                  <ion-icon [name]="'square-outline'"></ion-icon>
                </ion-col>
                <ion-col class="form-value no-border" size="4">{{ 'OBSERVED_LOCATION.REPORT.FORM.LANDING.ARP_FILE_NAME' | translate }}</ion-col>
                <ion-col class="form-value no-border" size="6"></ion-col>
              </ion-row>
            </ion-grid>
          </ion-col>
        </ion-row>
      </ion-grid>

      <!-- Comment section -->
      <ion-grid class="report-section">
        <ion-row class="section-title">
          <ion-col>
            <h3>{{ 'OBSERVED_LOCATION.REPORT.FORM.COMMENTS' | translate }}</h3>
          </ion-col>
        </ion-row>
        <ion-row class="form-field" [style.--form-field-height]="'120px'">
          <ion-col class="form-value" size="12">
            {{ data?.comments }}
          </ion-col>
        </ion-row>
      </ion-grid>

      <ng-content *ngTemplateOutlet="pageFooter; context: { help: 'OBSERVED_LOCATION.REPORT.FORM.LANDING.HELP' }"></ng-content>
    </section>

    <section>
      @for (landings of stats.landingTableRowChunk; track $index) {
        <section *sectionDef class="landscape">
          <ng-content *ngTemplateOutlet="pageHeader; context: { title: 'OBSERVED_LOCATION.REPORT.FORM.SAMPLES.TITLE' }"></ng-content>
          @if ($first) {
            <ion-grid class="report-section landing-table-summary">
              <ion-row>
                <ion-col size="6">
                  <ion-grid class="ion-no-padding ion-no-margin">
                    <ion-row class="section-title ion-no-margin ion-justify-content-between">
                      <ion-col class="ion-no-padding ion-no-margin" size="auto">
                        <h3>{{ 'OBSERVED_LOCATION.REPORT.FORM.SAMPLES.TOTAL_NUMBER_OF_VESSEL_SAMPLED' | translate }}</h3>
                      </ion-col>
                      <ion-col class="title-value ion-text-center font-large no-border-bottom ion-no-padding ion-no-margin" size="2">
                        @if (!isBlankForm) {
                          {{ stats?.nbSampledVessel }}
                        }
                      </ion-col>
                    </ion-row>
                    <ion-row class="section-title ion-no-margin ion-justify-content-between">
                      <ion-col class="ion-no-padding ion-no-margin" size="auto">
                        <h3>{{ 'OBSERVED_LOCATION.REPORT.FORM.SAMPLES.NB_OF_PRIORITY_SPECIES_SAMPLED' | translate }}</h3>
                      </ion-col>
                      <ion-col class="title-value ion-text-right font-large ion-no-padding ion-no-margin" size="2">
                        @if (!isBlankForm) {
                          {{ stats.observedCount }}
                        } @else {
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        }
                        &nbsp;/&nbsp; {{ stats.minObservedSpeciesCount }}&nbsp;
                      </ion-col>
                    </ion-row>
                  </ion-grid>
                </ion-col>
                <ion-col class="vertical-centred-content" size="6">
                  <ion-grid class="ion-no-padding ion-no-margin inner-grid">
                    <ion-row class="section-title form-filed ion-no-margin ion-justify-content-between">
                      <ion-col class="ion-no-padding ion-no-margin ion-text-right" size="6">
                        <h3 [style.margin]="0">{{ 'OBSERVED_LOCATION.REPORT.FORM.SAMPLES.PRESENCE_OF_PETS' | translate }}</h3>
                      </ion-col>
                      <ion-col class="vertical-centred-content horizontal-centred-content" size="2">
                        {{ 'COMMON.YES' | translate }}
                        &nbsp;
                        <ion-icon [name]="(data.measurementValues | mapGet: pmfmIdsMap.HAS_PETS) ? 'checkbox-outline' : 'square-outline'"></ion-icon>
                      </ion-col>
                      <ion-col class="vertical-centred-content horizontal-centred-content" size="2">
                        {{ 'COMMON.NO' | translate }}
                        &nbsp;
                        <ion-icon [name]="!(data.measurementValues | mapGet: pmfmIdsMap.HAS_PETS) ? 'checkbox-outline' : 'square-outline'"></ion-icon>
                      </ion-col>
                      <ion-col size="2"></ion-col>
                    </ion-row>
                  </ion-grid>
                </ion-col>
              </ion-row>
              <ion-row>
                <ion-col>
                  <em>
                    {{ 'OBSERVED_LOCATION.REPORT.FORM.SAMPLES.HELP' | translate }}
                  </em>
                </ion-col>
              </ion-row>
            </ion-grid>
          }
          <table class="table-full-width" [style.margin-top]="'10px'" [style.--row-title-height]="'40px'" [style.--row-height]="'65px'">
            <thead>
              <tr>
                <th class="ion-text-center font-medium">
                  {{ 'OBSERVED_LOCATION.REPORT.FORM.SAMPLES.VESSEL_REGISTRATION_CODE' | translate }}
                </th>
                @for (pmfm of stats.pmfms.landing | arrayFilter: filterPmfmForLandingTable; track pmfm.id) {
                  <th class="ion-text-center font-medium">
                    {{ pmfm | pmfmName: { i18nPrefix: i18nContext.pmfmPrefix, i18nContext: i18nContext.suffix } }}
                  </th>
                }
                <th class="ion-text-center font-medium">
                  {{ 'OBSERVED_LOCATION.REPORT.FORM.COMMENTS' | translate }}
                </th>
              </tr>
            </thead>
            <tbody>
              @for (landing of landings; track landing.rankOrder) {
                <tr>
                  <td class="font-medium">
                    {{ landing.vesselSnapshot?.registrationCode || landing.vesselSnapshot?.intRegistrationCode }}
                  </td>
                  @for (pmfm of stats.pmfms.landing | arrayFilter: filterPmfmForLandingTable; track pmfm) {
                    <td class="font-medium">
                      <div
                        [innerHTML]="
                          landing.measurementValues | mapGet: pmfm.id | pmfmValue: { pmfm: pmfm, html: false, propertyNames: ['label', 'name'] }
                        "
                      ></div>
                    </td>
                  }
                  <td class="font-medium">
                    {{ landing.comments }}
                  </td>
                </tr>
              }
            </tbody>
          </table>
          <ng-content *ngTemplateOutlet="pageFooter; context: { help: 'OBSERVED_LOCATION.REPORT.FORM.LANDING.HELP' }"></ng-content>
        </section>
      }
    </section>

    @for (sale of stats.sales; track sale.id) {
      <section>
        @if (stats.denormalizedBatchesBySale | mapGet: sale.id | isNotEmptyArray) {
          @for (
            batchesChunk of stats.denormalizedBatchesBySale | mapGet: sale.id | splitArrayInChunks: 28;
            track $index;
            let isLastBatchesChunk = $last , isFirstBatchesChunk = $first
          ) {
            <section *sectionDef class="portrait">
              <ng-content *ngTemplateOutlet="pageHeader; context: { title: 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.TITLE' }"></ng-content>
              <ion-grid class="report-section ion-no-padding">
                <ion-row class="section-title">
                  <ion-col size="3">
                    <h3>{{ 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.VESSEL_NAME_AND_IMAT' | translate }}</h3>
                  </ion-col>
                  <ion-col class="title-value ion-text-center font-large no-border-bottom" size="4">
                    @if (!isBlankForm) {
                      {{ sale.vesselSnapshot.name }} - {{ sale.vesselSnapshot.exteriorMarking }}
                    }
                  </ion-col>
                </ion-row>
              </ion-grid>
              <table [style.--row-height]="'30px'">
                <thead>
                  <tr class="group-head">
                    <th colspan="4" class="no-border">
                      <ion-grid class="ion-no-padding ion-no-margin">
                        <ion-row>
                          <ion-col size="6" class="vertical-centred-content">
                            {{ 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.EXCLUSIVE_SCIENTIFIC_SPECIES' | translate }}
                          </ion-col>
                          <ion-col size="3" class="vertical-centred-content">
                            <ion-icon
                              [style.font-size]="'1.5em'"
                              [name]="batchesChunk[0].exhaustiveInventory ? 'checkbox-outline' : 'square-outline'"
                            ></ion-icon>
                            &nbsp;
                            {{ 'COMMON.YES' | translate }}
                          </ion-col>
                          <ion-col size="3" class="vertical-centred-content">
                            <ion-icon
                              [style.font-size]="'1.5em'"
                              [name]="!batchesChunk[0].exhaustiveInventory ? 'checkbox-outline' : 'square-outline'"
                            ></ion-icon>
                            &nbsp;
                            {{ 'COMMON.NO' | translate }}
                          </ion-col>
                        </ion-row>
                      </ion-grid>
                    </th>
                    <th colspan="2" class="col-small"></th>
                    <th colspan="3" class="col-small ion-text-center">
                      {{ 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.BATCH.SUB_SAMPLING' | translate }}
                    </th>
                  </tr>
                  <tr>
                    <th class="col-tiny no-border ion-text-center no-margin no-padding">
                      <mat-icon class="mat-icon mat-icon-sm">arrow_downward</mat-icon>
                    </th>
                    <th class="col-medium ion-text-center">{{ 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.TAXON_GROUPS' | translate }}</th>
                    <th class="col-medium ion-text-center">{{ 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.TAXON_NAMES' | translate }}</th>
                    <th class="col-extra-large ion-text-center">{{ 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.SORT_CRITERIAS' | translate }}</th>
                    <th class="col-small ion-text-center">{{ 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.TOTAL_WEIGHT' | translate }}</th>
                    <th class="col-small ion-text-center">{{ 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.TOTAL_INDIV' | translate }}</th>
                    <th class="col-small ion-text-center">{{ 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.FRACTION' | translate }}</th>
                    <th class="col-small ion-text-center">{{ 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.WEIGHT' | translate }}</th>
                    <th class="col-small ion-text-center">{{ 'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.NB_INDIV' | translate }}</th>
                  </tr>
                </thead>
                <tbody>
                  @for (batch of batchesChunk; track batch.id) {
                    <tr>
                      <td class="col-tiny no-margin no-padding ion-text-center font-large">
                        <ion-icon [style.font-size]="'1.1em'" [name]="batch.exhaustiveInventory ? 'checkbox-outline' : 'square-outline'"></ion-icon>
                      </td>
                      <td class="col-medium">{{ batch.taxonGroup | referentialToString }}</td>
                      <td class="col-medium">{{ batch.taxonName | referentialToString }}</td>
                      <td class="col-extra-large no-margin no-padding">
                        <div class="denormalized-batch-sorting-values">
                          <div class="denormalized-batch-tree-indent" [innerHtml]="batch.treeIndent"></div>
                          <div class="denormalized-batch-sorting-values-text">
                            @if (batch.qualityFlagId | qualityFlagInvalid) {
                              <ion-icon [name]="batch.qualityFlagId | qualityFlagToIcon" color="danger"></ion-icon>
                            }
                            <b>
                              @if (batch.individualCount === 1) {
                                {{ batch.sortingValuesText }}
                              } @else {
                                @for (pmfmId of batch.measurementValues | mapKeys; track pmfmId; let last = $last) {
                                  {{
                                    batch.measurementValues
                                      | mapGet: pmfmId
                                      | pmfmValue
                                        : {
                                            pmfm: stats.pmfmsByIds.denormalizedBatch | mapGet: pmfmId,
                                            propertyNames: ['label', 'name'],
                                            html: false,
                                            showYesOrNo: true
                                          }
                                  }}
                                  @if (!last) {
                                    ,&nbsp;
                                  }
                                }
                              }
                            </b>
                          </div>
                        </div>
                      </td>
                      <td class="col-small ion-text-right">
                        @if (!(batch | denormalizeBatchIsIndividual)) {
                          {{ batch.elevateWeight }}
                        }
                      </td>
                      <td class="col-small ion-text-right">
                        @if (!(batch | denormalizeBatchIsIndividual)) {
                          {{ batch.elevateIndividualCount }}
                        }
                      </td>
                      <td class="col-small ion-text-right">{{ batch.samplingRatioText || batch.samplingRatio }}</td>
                      <td class="col-small ion-text-right" [class.computed]="batch.weight | isNil">
                        {{ batch.weight || batch.indirectWeight }}
                      </td>
                      <td class="col-small ion-text-right" [class.computed]="batch.individualCount | isNil">
                        {{ batch.individualCount || batch.indirectIndividualCount }}
                      </td>
                    </tr>
                  }
                </tbody>
                <caption [innerHTML]="'OBSERVED_LOCATION.REPORT.FORM.MEASUREMENTS.TABLE_LEGEND' | translate"></caption>
              </table>
              <ng-content *ngTemplateOutlet="pageFooter; context: { help: 'OBSERVED_LOCATION.REPORT.FORM.LANDING.HELP' }"></ng-content>
            </section>
          }
        }
      </section>
    }
  </app-reveal>

  <ng-template #pageHeader let-title="title" let-titleParams="titleParams">
    <ion-grid class="report-header ion-no-padding">
      <ion-row class="page-title">
        <ion-col class="logo" size="auto">
          @if (stats?.logoHeadLeftUrl | isNotNilOrBlank) {
            <img [src]="stats.logoHeadLeftUrl" />
          }
        </ion-col>
        <ion-col>
          <ion-grid class="ion-no-padding">
            <ion-row class="title-items">
              <ion-col size="auto">
                {{ 'OBSERVED_LOCATION.REPORT.FORM.TRIP_DATE' | translate }}
                @if (isBlankForm) {
                  ...../...../......
                } @else {
                  {{ data.startDateTime | dateFormat: { time: false } }}
                }
              </ion-col>
              <ion-col size="auto">
                {{ 'OBSERVED_LOCATION.REPORT.FORM.TRIP_LOCATION' | translate }}
                @if (isBlankForm) {
                  .................................
                } @else {
                  {{ data.location?.name }}
                }
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-col>
        <ion-col>
          <h2>
            {{ title | translateContext: i18nContext.suffix : titleParams }}
            @if (titleParams?.pageNumber; as pageNumber) {
              ({{ 'COMMON.REPORT.PAGE_NUMBER' | translate: { pageNumber } }})
            }
          </h2>
        </ion-col>
        <ion-col class="logo" size="auto">
          @if (stats?.logoHeadLeftUrl | isNotNilOrBlank) {
            <img [src]="stats.logoHeadRightUrl" />
          }
        </ion-col>
      </ion-row>
    </ion-grid>
  </ng-template>

  <ng-template #pageFooter let-help="help">
    <ion-grid class="report-footer ion-no-padding">
      @if (help | isNotNilOrBlank) {
        <ion-row class="footer-help">
          <ion-col>
            {{ help | translate }}
          </ion-col>
        </ion-row>
      }
      <ion-row class="footer-text">
        <ion-col [innerHTML]="stats.footerText"></ion-col>
      </ion-row>
    </ion-grid>
  </ng-template>

  <ng-template #loadingTemplate>
    <div class="loader">
      <ion-spinner slot="start" color="secondary" size="large"></ion-spinner>
    </div>
  </ng-template>

  <ng-template #latLongPlaceHolder>
    <span class="font-large place-holder">
      <span [style.letter-spacing]="'3px'">__°__.___</span>
      N
      <br />
      <span [style.letter-spacing]="'3px'">__°__.___</span>
      E ou W
    </span>
  </ng-template>
</ion-content>
